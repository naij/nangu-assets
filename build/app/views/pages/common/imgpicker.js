define("app/views/pages/common/imgpicker",["magix","jquery","app/mixins/dialog"],function(a,i,e){var t=a("magix"),s=a("jquery"),c=a("app/mixins/dialog");e.exports=t.View.extend({tmpl:'<div class="image-picker"><div class="dialog-hd"><h2 class="dialog-title">\u9009\u62e9\u56fe\u7247</h2></div><div class="dialog-bd"><div class="upload"><a href="#" class="btn btn-large btn-green" mx-click="upload()">\u672c\u5730\u4e0a\u4f20</a></div><ul class="image-container clearfix">{{#for(item in list)}}<li t-class:selected="item.selected" mx-click="pick({index:{{__INDEX__}}})"><div class="img-block"><img src="{{item.picPath}}?x-oss-process=style/p_30" class="img"/></div><div class="name">{{item.picName}}</div><div class="mask"><span class="iconfont iconduigou"></span></div></li>{{/for}}</ul><div class="pager-container" mx-view="app/coms/pagination/pagination?total={{totalCount}}&size={{pageSize}}&page={{pageNo}}" mx-change="pageChange()"></div></div><div class="dialog-ft"><a href="javascript:;" class="btn btn-brand btn-large mr10" mx-click="submit()" t-if="selectedList.length > 0">\u786e\u5b9a</a><a href="javascript:;" class="btn btn-disabled btn-large mr10" t-if="selectedList.length == 0">\u786e\u5b9a</a><a href="javascript:;" class="btn btn-normal btn-large" mx-click="cancel()">\u53d6\u6d88</a></div></div>',mixins:[c],init:function(a){this.extraData=a},render:function(){var a=this,i=a.pageNo||1,e=10;a.request().all([{name:"picture_list",params:{pageNo:i,pageSize:e}}],function(t,s){var c=s.get("data");a.data={list:c.list,selectedList:[],pageNo:i,pageSize:e,totalCount:c.totalCount},a.setView()})},"pick<click>":function(a){var i,e=this,t=e.extraData.limit,c=a.params.index,l=e.data.list,n=e.data.selectedList;s.each(n,function(a,e){e.id==l[c].id&&(i=a)}),"undefined"!=typeof i?n.splice(i,1):n.length<t?n.push(l[c]):(n.shift(),n.push(l[c])),s.each(l,function(a,i){i.selected=!1,s.each(n,function(a,e){i.id==e.id&&(i.selected=!0)})}),e.data={list:l,selectedList:n},e.setView()},"upload<click>":function(a){a.preventDefault();var i=this;i.mxDialog("app/views/pages/picture/upload",{width:700,callback:function(){i.render()}})},"pageChange<change>":function(a){this.pageNo=a.state.page,this.data.selectedList=[],this.render()},"submit<click>":function(a){a.preventDefault(),this.extraData.dialog.close(),this.extraData.callback(this.data.selectedList)},"cancel<click>":function(a){a.preventDefault(),this.extraData.dialog.close()}})});