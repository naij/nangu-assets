define("app/views/pages/common/imgpicker",["magix","jquery","app/mixins/dialog"],function(i,a,e){var t=i("magix"),s=i("jquery"),c=i("app/mixins/dialog");e.exports=t.View.extend({tmpl:'<div class="image-picker"><div class="dialog-hd"><h2 class="dialog-title">\u9009\u62e9\u56fe\u7247</h2></div><div class="dialog-bd"><div class="upload"><a href="#" class="btn btn-large btn-green" mx-click="upload()">\u672c\u5730\u4e0a\u4f20</a></div><ul class="image-container clearfix">{{#for(item in list)}}<li t-class:selected="item.selected" mx-click="pick({index:{{__INDEX__}}})"><div class="img-block"><img src="{{item.picPath}}?x-oss-process=style/p_30" class="img"/></div><div class="name">{{item.picName}}</div><div class="mask"><span class="iconfont iconduigou"></span></div></li>{{/for}}</ul></div><div class="dialog-ft"><a href="javascript:;" class="btn btn-brand btn-large mr10" mx-click="submit()" t-if="selectedList.length > 0">\u786e\u5b9a</a><a href="javascript:;" class="btn btn-disabled btn-large mr10" t-if="selectedList.length == 0">\u786e\u5b9a</a><a href="javascript:;" class="btn btn-normal btn-large" mx-click="cancel()">\u53d6\u6d88</a></div></div>',mixins:[c],init:function(i){this.extraData=i},render:function(){var i=this;i.request().all([{name:"picture_list"}],function(a,e){var t=e.get("data");i.data={list:t.list,selectedList:[]},i.setView()})},"pick<click>":function(i){var a,e=this,t=e.extraData.limit,c=i.params.index,l=e.data.list,n=e.data.selectedList;s.each(n,function(i,e){e.id==l[c].id&&(a=i)}),"undefined"!=typeof a?n.splice(a,1):n.length<t?n.push(l[c]):(n.shift(),n.push(l[c])),s.each(l,function(i,a){a.selected=!1,s.each(n,function(i,e){a.id==e.id&&(a.selected=!0)})}),e.data={list:l,selectedList:n},e.setView()},"upload<click>":function(i){i.preventDefault();var a=this;a.mxDialog("app/views/pages/picture/upload",{width:700,callback:function(){a.render()}})},"submit<click>":function(i){i.preventDefault(),this.extraData.dialog.close(),this.extraData.callback(this.data.selectedList)},"cancel<click>":function(i){i.preventDefault(),this.extraData.dialog.close()}})});