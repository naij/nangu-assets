define("app/views/pages/product/tag/category_tag_relation",["magix","jquery"],function(e,a,t){var i=e("magix"),l=e("jquery");t.exports=i.View.extend({tmpl:'<div class="page-header clearfix"><div class="title-bar"><h2 class="title">\u8bbe\u7f6e\u6807\u7b7e</h2></div></div><div class="page-body"><form id="relation-create-form"><input type="hidden" name="categoryId" value="{{categoryId}}"><ul class="union-form"><li class="field"><p class="field-label2">\u9009\u62e9\u6807\u7b7e</p><div><label class="mr20" t-for="item in tagList"><input type="checkbox" checked="{{item.selected}}" class="mr5" name="relation[]" value="{{item.id}}:{{item.relationId}}"> {{item.name}}</label></div></li><li class="field"><a href="#" class="btn btn-brand btn-large" mx-click="submit()">\u63d0\u4ea4</a></li></ul></form></div>',render:function(){var e=this,a=e.param("categoryId");e.request().all([{name:"tag_list",params:{type:1}},{name:"category_tag_relation_list",params:{categoryId:a}}],function(t,i,l){var r=i.get("data").list,n=l.get("data").list;r.forEach(function(e){e.selected=!1,e.relationId="",n.forEach(function(a){e.id==a.tagId&&(e.selected=!0,e.relationId=a.id)})}),e.data={categoryId:a,tagList:r,originRelationList:n},e.setView()})},"submit<click>":function(e){e.preventDefault();var a=this,t=l("#relation-create-form").serializeJSON({useIntKeysAsArrayIndex:!0}),i=t.relation,r=a.data.originRelationList,n=[];r.forEach(function(e){n.push(e.id),i.forEach(function(a){var t=a.split(":");if(t[1]&&t[1]==e.id){var i=n.indexOf(e.id);n.splice(i,1)}})}),t.deletedRealtionList=n,a.request().all([{name:"category_tag_relation_create",params:t}],function(){window.history.go(-1)})}})});